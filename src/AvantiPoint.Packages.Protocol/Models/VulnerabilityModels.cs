using System;
using System.Collections.Generic;
using System.Text.Json.Serialization;

namespace AvantiPoint.Packages.Protocol.Models
{
    /// <summary>
    /// Represents the vulnerability index response.
    /// See: https://learn.microsoft.com/en-us/nuget/api/vulnerability-info
    /// </summary>
    public class VulnerabilityIndexResponse
    {
        /// <summary>
        /// The version of the vulnerability index format.
        /// </summary>
        [JsonPropertyName("version")]
        public string Version { get; set; }

        /// <summary>
        /// The list of vulnerability pages.
        /// </summary>
        [JsonPropertyName("pages")]
        public IReadOnlyList<VulnerabilityPageInfo> Pages { get; set; }
    }

    /// <summary>
    /// Represents a vulnerability page entry in the index.
    /// </summary>
    public class VulnerabilityPageInfo
    {
        /// <summary>
        /// The URL for this vulnerability page.
        /// </summary>
        [JsonPropertyName("@id")]
        public string Id { get; set; }

        /// <summary>
        /// The name of this page.
        /// </summary>
        [JsonPropertyName("@name")]
        public string Name { get; set; }

        /// <summary>
        /// The timestamp when this page was last updated.
        /// </summary>
        [JsonPropertyName("@updated")]
        public DateTime Updated { get; set; }

        /// <summary>
        /// Optional comment about this page.
        /// </summary>
        [JsonPropertyName("comment")]
        public string Comment { get; set; }
    }

    /// <summary>
    /// Represents a vulnerability page containing vulnerabilities for one or more packages.
    /// The page is a dictionary where keys are lowercase package IDs and values are arrays of vulnerabilities.
    /// </summary>
    public class VulnerabilityPageResponse : Dictionary<string, IReadOnlyList<PackageVulnerabilityInfo>>
    {
    }

    /// <summary>
    /// Represents a vulnerability affecting a package.
    /// </summary>
    public class PackageVulnerabilityInfo
    {
        /// <summary>
        /// The URL to the vulnerability advisory.
        /// </summary>
        [JsonPropertyName("url")]
        public string Url { get; set; }

        /// <summary>
        /// The severity of the vulnerability (e.g., "Low", "Moderate", "High", "Critical").
        /// </summary>
        [JsonPropertyName("severity")]
        public string Severity { get; set; }

        /// <summary>
        /// The version range affected by this vulnerability.
        /// </summary>
        [JsonPropertyName("versions")]
        public string Versions { get; set; }
    }
}
