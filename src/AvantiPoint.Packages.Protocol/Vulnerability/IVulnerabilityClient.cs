using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;
using AvantiPoint.Packages.Protocol.Models;

namespace AvantiPoint.Packages.Protocol
{
    /// <summary>
    /// The Vulnerability Info resource, used to retrieve vulnerability information for packages.
    /// 
    /// See: https://learn.microsoft.com/en-us/nuget/api/vulnerability-info
    /// </summary>
    public interface IVulnerabilityClient
    {
        /// <summary>
        /// Get the vulnerability index, or null if the server does not support vulnerability info.
        /// See: https://learn.microsoft.com/en-us/nuget/api/vulnerability-info
        /// </summary>
        /// <param name="cancellationToken">A token to cancel the task.</param>
        /// <returns>The vulnerability index, or null if not supported.</returns>
        Task<VulnerabilityIndexResponse> GetIndexOrNullAsync(
            CancellationToken cancellationToken = default);

        /// <summary>
        /// Get vulnerabilities for a specific package ID across all versions, or an empty list if none exist.
        /// </summary>
        /// <param name="packageId">The package ID.</param>
        /// <param name="cancellationToken">A token to cancel the task.</param>
        /// <returns>List of vulnerabilities for the package, or an empty list if none exist.</returns>
        Task<IReadOnlyList<PackageVulnerabilityInfo>> GetVulnerabilitiesAsync(
            string packageId,
            CancellationToken cancellationToken = default);

        /// <summary>
        /// Get a vulnerability page by URL, or null if it does not exist.
        /// </summary>
        /// <param name="pageUrl">The URL of the vulnerability page.</param>
        /// <param name="cancellationToken">A token to cancel the task.</param>
        /// <returns>The vulnerability page, or null if it does not exist.</returns>
        Task<VulnerabilityPageResponse> GetPageOrNullAsync(
            string pageUrl,
            CancellationToken cancellationToken = default);
    }
}
